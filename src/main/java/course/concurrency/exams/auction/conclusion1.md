# Результаты #

Реализации [Auction](./Auction.java) с пессимистичными и оптимистичными блокировками.
- optimistic: 954 (606-1357)
- pessimistic: 991 (742-1282)

> Q: По нотифаеру - а почему ты выбрал такую реализацию?

A: Мне показалось, что она самая лаконичная и удовлетворяет требованиям: неблокирующая отправка сообщений.
Конечно, если быть честным, то это скорее подход: в любой непонятной ситуации выбирай CompletableFuture.
Однако, мне кажется, что здесь CompletableFuture подходит по требованиям, и думаю, что он обладает адекватными
настройками по умолчанию. Я считаю, что здесь разработчики java "подумали за меня" и грех было бы этим не 
воспользоваться. А если будет нужно изменить executor, например, после нагрузочного тестирования, то это будет
достаточно легко сделать. 

> По нотифаеру: у CF по умолчанию всё выполняется в ForkJoinPool.commonPool(). Там всего 7 потоков в 
> пуле(если ядер 8). Ранее мы разбирали разные подходящие настройки для разных типов задач,
> и тут прекрасное место, чтобы применить эти знания)

Переделал Notifier. Соображения следующие: нотификация - это блокирующая задача, а не вычислительная, т.к.
в тестовой реализации поток просто спит, а в реальной системе это скорее всего будет сетевое взаимодействие.
Учитывая предметную область - аукцион, можно ожидать, что нотификаций будет много, а точнее количество 
нотификаций будет приблизительно равняться количеству ставок. С такими вводными возможно применить fixedThreadPool,
при этом чем больше кол-во потоков, тем выше производительность, но и выше количество потребляемой памяти.
Поигрался с различным количеством потоков: 120 - 250 - 500 пула Notifier-а (цифры ниже), хотя, конечно,
количество наблюдений небольшое, результаты отличались не сильно. В итоге выбрал значение 120, т.к. время 
выполнения при каждом варианте приблизительно одинаковое, а вариант со 120 потоками в пуле наименее ресурсоемкий. 
В реальной системе постарался бы получить какую-нибудь начальную информацию об ожидаемом количестве ставок
и важности нотификаций, попробовал бы сформулировать дополнительные требования к нотификации и попытался оценить
сколько ресурсов понадобится. Но т.к. часто бывает, что заранее информации не много, то скорее всего выбрал бы 
кол-во потоков в районе 250 (т.е. примерно рядом с умолчаниями спринг-бута). Далее наблюдал бы за общими метриками
системы: потреблением памяти и ЦПУ, кол-вом трафика, и, если нотификации это важная часть системы, то за временем
выполнения нотификации и рейтом нотификаций. Исходя из полученной информации, делал бы выводы по тому в какую
сторону двигаться. В более простом варианте - увеличивать или уменьшать кол-во потоков в пуле. В более сложном,
например, если бы у нотификаций был какой-то паттерн нагрузки, допустим зависимость кол-ва от времени суток, либо
наличие редких пиков, делать более тонкие настройки, то, минимальное и максимальное кол-во потоков в пуле,
время жизни потока.

Ниже то что у меня получилось по цифрам:

120
optimistic: 2620 (1952-2924)
pessimistic: 2789 (2407-3187)

250
optimistic: 2798 (2511-3141)
pessimistic: 2774 (2442-3219)

500
optimistic: 2952 (2105-4470)
pessimistic: 2883 (2461-3229)
