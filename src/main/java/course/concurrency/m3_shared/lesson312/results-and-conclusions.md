1. Тестовые условия
    * версия java VM version: JDK 17.0.1, Java HotSpot(TM) 64-Bit Server VM, 17.0.1+12-LTS-39
    * Процессор `AMD Ryzen 7 5800U` кол-во ядер 8.
    * hyper-trading есть - 2 потока на ядро, итого получается 16 потоков, которые в ОС названы логическими процессорами.
    * ОС Windows 11
2. План: протестировать 3 варианта нагрузки: слабая нагрузка, нормальная нагрузка, высокая нагрузка - 8, 16, 48 потоков
   соответственно
3. Проведены замеры для различных нагрузок и сценариев для каждой нагрузки со следующими соотношениями потоков:
   1 читатель, остальные писатели, поровну читателей и писателей, 1 писатель, остальные читатели. Результаты сведены в
   таблице ниже.

   | test                                              |      R1-W7 |       R4-W4 |       R7-W1 |     R1-W15 |        R8-W8 |      R15-W1 |      R1-W47 |     R24-W24 |       R47-W1 |
   |:--------------------------------------------------|-----------:|------------:|------------:|-----------:|-------------:|------------:|------------:|------------:|-------------:|
   | AtomicLong:readAtomicLong                         |  66413,411 |  718294,684 | 3489326,959 |  16661,563 |   264727,851 | 4269691,831 |    5604,638 |  282044,655 |  9263927,832 |
   | AtomicLong:writeAtomicLong                        |  78141,304 |   48002,042 |   12243,261 |  80484,806 |    46029,996 |    6520,712 |   83060,282 |   43533,944 |     2181,803 |
   | LongAdder:readLongAdder                           |   6969,464 |   48002,042 | 2889432,129 |   2434,448 |    17931,992 | 4050669,875 |     531,279 |   19405,621 |  6027187,143 |
   | LongAdder:writeLongAdder                          | 242078,622 |   54008,323 |    6311,306 | 716446,113 |    68939,731 |    5238,560 | 1989488,156 |   83278,716 |     1200,320 |
   | ReadWriteLock:readReadWriteLock                   |     18,349 |    9158,181 |    9851,636 |      8,822 |     5074,265 |    6025,896 |       2,826 |    5893,845 |     4777,738 |
   | ReadWriteLock:writeReadWriteLock                  | 124610,886 |   60540,997 |   16270,523 | 107914,639 |    55018,284 |    3579,639 |  129762,584 |   52446,342 |       10,359 |
   | ReadWriteLock_fair:readReadWriteLockFair          |     20,716 |      79,956 |     139,415 |      9,966 |       78,787 |     147,258 |       3,284 |      78,607 |      151,612 |
   | ReadWriteLock_fair:writeReadWriteLockFair         |    145,019 |      79,957 |      19,916 |    149,492 |       78,787 |       9,817 |     154,365 |      78,607 |        3,226 |
   | ReentrantLock:readReentrantLock                   |  18567,834 |   71538,315 |  118565,330 |   8458,469 |    73629,341 |  135497,663 |    3265,004 |   69419,247 |   131043,942 |
   | ReentrantLock:writeReentrantLock                  | 137512,163 |   69712,574 |   17081,668 | 130674,585 |    68693,275 |    8725,522 |  142446,590 |   70787,033 |     2918,469 |
   | ReentrantLock_fair:readReentrantLockFair          |     20,564 |      79,941 |     140,342 |      9,927 |       78,820 |     149,567 |       3,284 |      78,500 |      153,363 |
   | ReentrantLock_fair:writeReentrantLockFair         |    143,947 |      79,941 |      20,049 |    148,899 |       78,820 |       9,971 |     154,344 |      78,500 |        3,263 |
   | Semaphore:readSemaphore                           |  14154,265 |   53697,678 |   97150,722 |   6940,826 |    56111,706 |  105982,074 |    2354,998 |   58397,056 |   111325,785 |
   | Semaphore:writeSemaphore                          |  99076,075 |   53885,168 |   13852,931 | 104656,078 |    55825,578 |    7072,619 |  113941,069 |   58359,778 |     2432,811 |
   | Semaphore_fair:readSemaphoreFair                  |     20,273 |      80,576 |     140,432 |     10,002 |       79,947 |     149,997 |       3,286 |      78,573 |      154,236 |
   | Semaphore_fair:writeSemaphoreFair                 |    141,909 |      80,576 |      20,062 |    150,023 |       79,947 |      10,000 |     154,452 |      78,573 |        3,282 |
   | StampedLock_optimistic:readStampedLockOptimistic  | 200069,016 |  741129,487 |  353784,832 | 228192,669 |  1350207,766 |  461190,154 |  271334,815 | 1607651,735 |  1688471,860 |
   | StampedLock_optimistic:writeStampedLockOptimistic |   6642,959 |    2636,336 |    2574,033 |   6277,288 |     1710,420 |    2168,457 |    4980,298 |    1029,969 |      485,106 |
   | StampedLock_readwrite:readStampedLockRW           |   7038,995 |   26990,440 |   43271,273 |   4830,714 |    24491,789 |   33481,297 |    1626,644 |   28094,899 |    15649,120 |
   | StampedLock_readwrite:writeStampedLockRW          | 107040,201 |   75974,829 |   24726,091 | 126053,913 |    79116,760 |   16516,381 |  129814,918 |   88828,275 |    10929,755 |
   | synchronized:readSynchronized                     |   6644,838 |   22782,567 |   35810,920 |   2600,151 |    21911,546 |   40657,987 |     901,370 |   21601,283 |    39513,632 |
   | synchronized:writeSynchronized                    |  47894,045 |   17421,971 |    3515,774 |  31441,388 |    22600,536 |    1864,238 |   33634,451 |   21074,298 |      616,210 |
   | volatile:readVolatile                             |  16832,816 |  388813,492 | 3382774,725 |  30569,710 |   383084,984 | 5118718,154 |    9777,805 |  445916,473 | 10029175,525 |
   | volatile:writeVolatile                            |  95977,155 |   51223,950 |   13392,624 |  86700,186 |    47375,465 |    7470,476 |   90413,326 |   38338,103 |     2074,157 |
   | volatile_synchronized:readSynchronizedVolatile    | 928438,067 | 3356191,921 | 4992011,862 | 932232,433 |  4426210,875 | 5353320,588 |  925832,133 | 8026935,898 | 10060409,828 |
   | volatile_synchronized:writeSynchronizedVolatile   |   7566,141 |    4542,246 |    2428,586 |   7545,310 |     3990,513 |    1558,835 |    7556,478 |    3321,346 |      892,582 |

4. Наблюдения и выводы:
    * AtomicLong: ощутимо лучше показывает себя при чтении с высокой конкуренцией и при записи с низкой конкуренцией,
      больше подходит для сценария: мало писателей и много читателей, например для редкого обновления счетчика и частого
      считывания значений
    * LongAdder: показывает хорошую производительность при параллельном обновлении, производительность при чтении
      существенно проигрывает AtomicLong. Подходит для сценария много писателей и мало читателей, например для
      накопления статистики, которая считывается редко.
    * ReadWriteLock: показывает большую производительность при захвате блокировки на запись, немного более эффективен
      при слабой нагрузке. Подходит для сценариев: много писателей - мало читателей и одинаковое кол-во читателей и
      писателей
    * ReentrantLock: нет различий при блокировке на запись или чтение, поэтому подходит для обоих вариантов. Показывает
      приблизительно одинаковую производительность на всех уровнях нагрузки. Логично применять его для сценария,
      когда количество операций чтения и записи примерно одинаковое, либо если характер нагрузки непонятен в качестве
      отправной точки.
    * Semaphore: результаты похожи на ReentrantLock - примерно одинаковая производительность для всех сценариев и
      уровней нагрузки, производительность немного увеличивается при увеличении конкурентности. Немного проигрывает
      ReentrantLock. Применять следует когда нужны сложные сценарии захвата и освобождения блокировки, а не просто
      lock и unlock. В простых случаях предпочтительней ReentrantLock
    * fair ReadWriteLock, ReentrantLock, Semaphore - показывают значительно сниженную по сравнению с "нечестными"
      версиями, в целом у всех решений приблизительно одинаковая производительность. Наверное стоит отметить такие
      особенности: общий throughput (запись и чтение) кратен (приблизительно) количеству ядер процессора, его
      соотношение на запись и на чтение приблизительно совпадает с соотношением потоков-читателей и потоков-писателей.
      Скорее всего, пониженная производительность "честных" версий связана с необходимостью поддерживать очередность
      доступа потоков к блокировке. Следует применять только в случае, когда "честная" версия действительно нужна.
    * StampedLock: оптимистические блокировки при чтении показывают гораздо более высокую производительность, чем
      пессимистические, с записью ситуация обратная - пессимистические блокировки при записи выигрывают. Показывает
      чуть большую производительность при высокой нагрузке и сбалансированном кол-ве писателей и читателей. При
      использовании для оптимистического чтения сильно выигрывает у ReentrantLock, при блокировках на запись - тоже
      заметно выигрывает у ReentrantLock, за исключением случаев с большим количеством потоков-писателей. Логично
      использовать при средней и высокой нагрузке, в случае преобладания количества читателей и равного кол-ва
      писателей и читателей
   * synchronized: приблизительно одинаковая производительность при разных сценариях и уровнях нагрузки, чуть лучше в
     случае небольшой и средней конкуренции. Преимущество - простота использования. Лучше всего применять на небольших
     нагрузках, когда требуется простое решение, возможно - в качестве отправной точки при средних нагрузках.
   * volatile: чтение переменной показывает высокие результаты, особенно при большом количестве потоков-читателей.
     Запись не синхронизированной переменной гораздо более производительна, чем запись синхронизированной. При не
     синхронизированной записи чуть лучше дело обстоит при низкой конкуренции. Наиболее хорошо подходят volatile
     переменные когда не требуется дополнительная синхронизация. Логично использовать в случах когда нет необходимости
     рассчитывать следующее значение на основании предыдущего. Хорошо подойдут при использовании с неизменяемыми
     переменными.

5. Инструменты по сценариям
    * Критическая секция - внутри может быть какой угодно код: ReadWriteLock, ReentrantLock, Semaphore, StampedLock,
      synchronized, volatile_synchronized. В большинстве случаев лучше всего себя показывает ReentrantLock,
      в случае, если в основном нужны чтения общей переменной, а ее изменения происходят редко лучше работает
      volatile c синхронизацией

   | test                                              |      R1-W7 |       R4-W4 |       R7-W1 |     R1-W15 |        R8-W8 |      R15-W1 |      R1-W47 |     R24-W24 |       R47-W1 |
   |:--------------------------------------------------|-----------:|------------:|------------:|-----------:|-------------:|------------:|------------:|------------:|-------------:|
   | ReadWriteLock:readReadWriteLock                   |     18,349 |    9158,181 |    9851,636 |      8,822 |     5074,265 |    6025,896 |       2,826 |    5893,845 |     4777,738 |
   | ReadWriteLock:writeReadWriteLock                  | 124610,886 |   60540,997 |   16270,523 | 107914,639 |    55018,284 |    3579,639 |  129762,584 |   52446,342 |       10,359 |
   | ReentrantLock:readReentrantLock                   |  18567,834 |   71538,315 |  118565,330 |   8458,469 |    73629,341 |  135497,663 |    3265,004 |   69419,247 |   131043,942 |
   | ReentrantLock:writeReentrantLock                  | 137512,163 |   69712,574 |   17081,668 | 130674,585 |    68693,275 |    8725,522 |  142446,590 |   70787,033 |     2918,469 |
   | Semaphore:readSemaphore                           |  14154,265 |   53697,678 |   97150,722 |   6940,826 |    56111,706 |  105982,074 |    2354,998 |   58397,056 |   111325,785 |
   | Semaphore:writeSemaphore                          |  99076,075 |   53885,168 |   13852,931 | 104656,078 |    55825,578 |    7072,619 |  113941,069 |   58359,778 |     2432,811 |
   | StampedLock_optimistic:readStampedLockOptimistic  | 200069,016 |  741129,487 |  353784,832 | 228192,669 |  1350207,766 |  461190,154 |  271334,815 | 1607651,735 |  1688471,860 |
   | StampedLock_optimistic:writeStampedLockOptimistic |   6642,959 |    2636,336 |    2574,033 |   6277,288 |     1710,420 |    2168,457 |    4980,298 |    1029,969 |      485,106 |
   | StampedLock_readwrite:readStampedLockRW           |   7038,995 |   26990,440 |   43271,273 |   4830,714 |    24491,789 |   33481,297 |    1626,644 |   28094,899 |    15649,120 |
   | StampedLock_readwrite:writeStampedLockRW          | 107040,201 |   75974,829 |   24726,091 | 126053,913 |    79116,760 |   16516,381 |  129814,918 |   88828,275 |    10929,755 |
   | synchronized:readSynchronized                     |   6644,838 |   22782,567 |   35810,920 |   2600,151 |    21911,546 |   40657,987 |     901,370 |   21601,283 |    39513,632 |
   | synchronized:writeSynchronized                    |  47894,045 |   17421,971 |    3515,774 |  31441,388 |    22600,536 |    1864,238 |   33634,451 |   21074,298 |      616,210 |
   | volatile_synchronized:readSynchronizedVolatile    | 928438,067 | 3356191,921 | 4992011,862 | 932232,433 |  4426210,875 | 5353320,588 |  925832,133 | 8026935,898 | 10060409,828 |
   | volatile_synchronized:writeSynchronizedVolatile   |   7566,141 |    4542,246 |    2428,586 |   7545,310 |     3990,513 |    1558,835 |    7556,478 |    3321,346 |      892,582 |

    * Обновление общей переменной: ReadWriteLock, ReentrantLock, Semaphore, StampedLock, synchronized, volatile,
      volatile_synchronized. В случаях большой нагрузки, а также средней и слабой, когда кол-во читателей равно
      или больше писателей - лучше работает StampedLock, в случае малой и средней нагрузки с большим количеством
      потоков-писателей быстрее ReentrantLock

   | test                                              |      R1-W7 |       R4-W4 |       R7-W1 |     R1-W15 |        R8-W8 |      R15-W1 |      R1-W47 |     R24-W24 |       R47-W1 |
      |:--------------------------------------------------|-----------:|------------:|------------:|-----------:|-------------:|------------:|------------:|------------:|-------------:|
   | ReadWriteLock:writeReadWriteLock                  | 124610,886 |   60540,997 |   16270,523 | 107914,639 |    55018,284 |    3579,639 |  129762,584 |   52446,342 |       10,359 |
   | ReentrantLock:writeReentrantLock                  | 137512,163 |   69712,574 |   17081,668 | 130674,585 |    68693,275 |    8725,522 |  142446,590 |   70787,033 |     2918,469 |
   | Semaphore:writeSemaphore                          |  99076,075 |   53885,168 |   13852,931 | 104656,078 |    55825,578 |    7072,619 |  113941,069 |   58359,778 |     2432,811 |
   | StampedLock_optimistic:writeStampedLockOptimistic |   6642,959 |    2636,336 |    2574,033 |   6277,288 |     1710,420 |    2168,457 |    4980,298 |    1029,969 |      485,106 |
   | StampedLock_readwrite:writeStampedLockRW          | 107040,201 |   75974,829 |   24726,091 | 126053,913 |    79116,760 |   16516,381 |  129814,918 |   88828,275 |    10929,755 |
   | synchronized:writeSynchronized                    |  47894,045 |   17421,971 |    3515,774 |  31441,388 |    22600,536 |    1864,238 |   33634,451 |   21074,298 |      616,210 |
   | volatile:writeVolatile                            |  95977,155 |   51223,950 |   13392,624 |  86700,186 |    47375,465 |    7470,476 |   90413,326 |   38338,103 |     2074,157 |
   | volatile_synchronized:writeSynchronizedVolatile   |   7566,141 |    4542,246 |    2428,586 |   7545,310 |     3990,513 |    1558,835 |    7556,478 |    3321,346 |      892,582 |

    * Счётчик: AtomicLong, LongAdder, ReadWriteLock, ReentrantLock, Semaphore, StampedLock, synchronized,
      volatile-synchronized. При редком обновлении счетчика на малой и средней нагрузке лучше работает AtomicLong,
      при частом обновлении, при любой нагрузке лучше LongAdder. Если обновлений совсем мало и преобладают чтения
      счетчика, то отлично подойдет volatile-synchronized

   | test                                              |      R1-W7 |       R4-W4 |       R7-W1 |     R1-W15 |        R8-W8 |      R15-W1 |      R1-W47 |     R24-W24 |       R47-W1 |
      |:--------------------------------------------------|-----------:|------------:|------------:|-----------:|-------------:|------------:|------------:|------------:|-------------:|
   | AtomicLong:readAtomicLong                         |  66413,411 |  718294,684 | 3489326,959 |  16661,563 |   264727,851 | 4269691,831 |    5604,638 |  282044,655 |  9263927,832 |
   | AtomicLong:writeAtomicLong                        |  78141,304 |   48002,042 |   12243,261 |  80484,806 |    46029,996 |    6520,712 |   83060,282 |   43533,944 |     2181,803 |
   | LongAdder:readLongAdder                           |   6969,464 |   48002,042 | 2889432,129 |   2434,448 |    17931,992 | 4050669,875 |     531,279 |   19405,621 |  6027187,143 |
   | LongAdder:writeLongAdder                          | 242078,622 |   54008,323 |    6311,306 | 716446,113 |    68939,731 |    5238,560 | 1989488,156 |   83278,716 |     1200,320 |
   | ReadWriteLock:readReadWriteLock                   |     18,349 |    9158,181 |    9851,636 |      8,822 |     5074,265 |    6025,896 |       2,826 |    5893,845 |     4777,738 |
   | ReadWriteLock:writeReadWriteLock                  | 124610,886 |   60540,997 |   16270,523 | 107914,639 |    55018,284 |    3579,639 |  129762,584 |   52446,342 |       10,359 |
   | ReentrantLock:readReentrantLock                   |  18567,834 |   71538,315 |  118565,330 |   8458,469 |    73629,341 |  135497,663 |    3265,004 |   69419,247 |   131043,942 |
   | ReentrantLock:writeReentrantLock                  | 137512,163 |   69712,574 |   17081,668 | 130674,585 |    68693,275 |    8725,522 |  142446,590 |   70787,033 |     2918,469 |
   | Semaphore:readSemaphore                           |  14154,265 |   53697,678 |   97150,722 |   6940,826 |    56111,706 |  105982,074 |    2354,998 |   58397,056 |   111325,785 |
   | Semaphore:writeSemaphore                          |  99076,075 |   53885,168 |   13852,931 | 104656,078 |    55825,578 |    7072,619 |  113941,069 |   58359,778 |     2432,811 |
   | StampedLock_optimistic:readStampedLockOptimistic  | 200069,016 |  741129,487 |  353784,832 | 228192,669 |  1350207,766 |  461190,154 |  271334,815 | 1607651,735 |  1688471,860 |
   | StampedLock_optimistic:writeStampedLockOptimistic |   6642,959 |    2636,336 |    2574,033 |   6277,288 |     1710,420 |    2168,457 |    4980,298 |    1029,969 |      485,106 |
   | StampedLock_readwrite:readStampedLockRW           |   7038,995 |   26990,440 |   43271,273 |   4830,714 |    24491,789 |   33481,297 |    1626,644 |   28094,899 |    15649,120 |
   | StampedLock_readwrite:writeStampedLockRW          | 107040,201 |   75974,829 |   24726,091 | 126053,913 |    79116,760 |   16516,381 |  129814,918 |   88828,275 |    10929,755 |
   | synchronized:readSynchronized                     |   6644,838 |   22782,567 |   35810,920 |   2600,151 |    21911,546 |   40657,987 |     901,370 |   21601,283 |    39513,632 |
   | synchronized:writeSynchronized                    |  47894,045 |   17421,971 |    3515,774 |  31441,388 |    22600,536 |    1864,238 |   33634,451 |   21074,298 |      616,210 |
   | volatile_synchronized:readSynchronizedVolatile    | 928438,067 | 3356191,921 | 4992011,862 | 932232,433 |  4426210,875 | 5353320,588 |  925832,133 | 8026935,898 | 10060409,828 |
   | volatile_synchronized:writeSynchronizedVolatile   |   7566,141 |    4542,246 |    2428,586 |   7545,310 |     3990,513 |    1558,835 |    7556,478 |    3321,346 |      892,582 |

