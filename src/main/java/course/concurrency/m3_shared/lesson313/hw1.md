# Задание 2. Практика: анализ кода #

Посмотрите код
класса [SimpleAnnotationMetadata](https://github.com/spring-projects/spring-framework/blob/b595dc1dfad9db534ca7b9e8f46bb9926b88ab5a/spring-core/src/main/java/org/springframework/core/type/classreading/SimpleAnnotationMetadata.java).
Включите бдительность на максимум.

Какие поля и в каких ситуациях могут измениться?

#### Ответ ####

В данном классе заметил единственное "подозрительное" поле - это `annotationTypes`. Проблему я вижу
в том, что данное поле является ссылкой, не помечено как `volatile`, не синхронизировано и имеет ленивую
инициализацию - похоже на поле `hash` в классе `String`. Проблемы могут возникнуть если метод
`getAnnotationTypes()` вызывается в многопоточной среде и разные потоки прочитают `annotationTypes` как null.
В этом случае "победит" поток, который запишет данное поле последним.

Написал код [MutationExample](./MutationExample.java) (насколько это корректный код - не знаю, буду благодарен
за ревью), иллюстрирующий данное поведение, в итоге у меня получился примерно такой вывод. Единственное, поскольку
класс не публичный, а копию в другом пакете не хочется закидывать в репозиторий, то код естественно не скомпилируется
если его просто клонировать. Чтобы всё было ОК нужно положить копию исходного кода класса в текущий пакет.

```text
   1:   1109371569 != 728890494
   2:    728890494 != 1768305536
   3:   1768305536 != 1530388690
   4:   1530388690 != 1146743572
   5:   1146743572 != 1512981843
   6:   1512981843 != 42768293
   7:     42768293 != 1717159510
   8:   1717159510 != 1834188994
   9:   1834188994 != 1174361318
  10:   1174361318 != 589873731
  11:    589873731 != 200006406
  12:    200006406 != 2052001577
  13:   2052001577 != 1160264930
  14:   1160264930 != 544724190
  15:    544724190 != 1972439101
```
